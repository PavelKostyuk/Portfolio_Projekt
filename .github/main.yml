name: CI/CD pipeline for Portfolio Django app

on:
  push:
  pull_request:
    branches: [main]

jobs:
  run-test:
    uses: ./.github/workflows/test.yml

  build_test_image_developer:
    uses: ./.github/workflows/build_and_test.yml
    needs: run-test
    if: github.ref == 'refs/heads/developer'

  build_test_push_image_main:
    uses: ./.github/workflows/build_test_push.yml
    needs: run-test
    if: github.ref == 'refs/heads/main'

  deploy_to_Docker_on_VM:
    uses: ./.github/workflows/deploy_to_Docker_on_VM.yml
    needs: build_test_push_image_main
    if: github.ref == 'refs/heads/main'
