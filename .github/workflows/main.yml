name: CI/CD pipeline for Portfolio Django app

on:
  push:
  pull_request:
    branches: [main]

jobs:
  run-test:
    runs-on: ubuntu-latest
    steps:
      - name: run-test  
      - uses: ./.github/workflows/test.yml

  build_test_image_developer:
    needs: run-test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/developer'
    steps:
      - name: build_test_image
      - uses: ./.github/workflows/build_and_test.yml

  build_test_push_image_main:
    needs: run-test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - name: build_test_push_image
      - uses: ./.github/workflows/build_test_push.yml

  deploy_to_Docker_on_VM:
    runs-on: ubuntu-latest
    needs: build_test_push_image
    if: github.ref == 'refs/heads/main'
    steps:
      - name: deploy_to_Docker_on_VM
      - uses: ./.github/workflows/deploy_to_Docker_on_VM.yml
